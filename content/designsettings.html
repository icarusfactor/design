<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">

    <title>DESIGN SETTINGS</title>
    <style>
    FIELDSET {
    margin: 8px;
    border: 2px solid grey;
    padding: 8px;    
    border-radius: 4px;
    background: #EFEFEF;
    max-width: 550px;
    }
    LEGEND{
    padding: 2px;    
    width: 250px;
    background: lightgrey;
    border: 1px solid black;
    text-align: left;
    margin-right: auto;
    }

   body.action-designsettings{
    background: grey;
    background-image: url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHdpZHRoPSc4JyBoZWlnaHQ9JzgnPgogIDxyZWN0IHdpZHRoPSc4JyBoZWlnaHQ9JzgnIGZpbGw9JyNmZmYnLz4KICA8cGF0aCBkPSdNMCAwTDggOFpNOCAwTDAgOFonIHN0cm9rZS13aWR0aD0nMC41JyBzdHJva2U9JyNhYWEnLz4KPC9zdmc+Cg==");
    background-repeat: repeat;
    min-height: 100%;
    }


    .scroll-box {
    height: 150px; /* Set a fixed height */
    width: 300px;  /* Set a fixed width */
    border: 1px solid #ccc; /* Add a border for visibility */
    overflow: auto; /* Enable scrollbars if content overflows */
    padding: 10px;    
    }

    .file-selected {
    margin: 0;
    padding: 0;
    border: none;
    background: transparent;
    color: #000000;
    cursor: pointer;
    }

    .file-selected:hover {
    margin: 0;
    padding: 0;
    border: none;
    background: #5179ff;
    color: #ffffff;
    cursor: pointer;
    }


    </style>

    <script>
    //Disable non-usable buttons.
    const tsize = window.parent.document.querySelector('.btn-tsize');
    const savedraft = window.parent.document.querySelector('.btn-savedraft');	     
    let exp_mode = localStorage.getItem("rcd_exp");

    tsize.disabled= true;
    savedraft.disabled= true;

    let TypeAr = [];	    
    let NameAr = [];	    
    let contentString = "";


async function GitHubDirContent(owner, repo, path = '', token = null) {
  const url = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;
  const headers = {
    'Accept': 'application/vnd.github.v3+json'
  };

  //Does not need to be added for public access. 		    
  if (token) {
    headers['Authorization'] = `token ${token}`;
  }

  try {
    const response = await fetch(url, { headers });
    if (!response.ok) {
      throw new Error(`GitHub API error: ${response.statusText}`);
    }
    const data = await response.json();
    return data; // This will be an array of file/directory objects
  } catch (error) {
    console.error('Error fetching GitHub directory contents:', error);
    return [];
  }
}



    //Init load of Github part file system 
    const owner = 'icarusfactor'; 
    const repo = 'designTmplPart'; 
    const directoryPath = 'part'; // Optional: path, or empty for root          


 function GitDirChange( owner, repo, directoryPath , subDirectory , type  ) {

  //If Subdirectory is empty dont add it.  
  if( subDirectory == '' ) {
              var directoryChange = directoryPath;
	      } else {
              //Changing directory we will need to add the new subdirectory, then auto update/refresh the list. 
              var directoryChange = directoryPath +"/" + subDirectory;
              }

  //Clear Arrays
  TypeAr.length = 0;	    
  NameAr.length = 0;	    
  contentString = "";

  GitHubDirContent(owner, repo, directoryChange )
  .then(contents => {
    if (contents.length > 0) {
      //console.log(`Files and directories in ${owner}/${repo}/${directoryChange || '(root)'}:`);
      var num=0;        

      //console.log( "LENGTH:" + contents.length);

      //contents.forEach(item => {
      for (const item of contents) {

        // Load Filenames into variables here.            
        //console.log(`- ${num} - ${item.type}: ${item.name}`);
        let itemtype =item.type;
        let itemname =item.name;

        TypeAr[num] = itemtype;           
        NameAr[num] = itemname;           
        //console.log( itemtype +" "+itemname );                  
        num++;            
      };
 
                        contentString = ' ';
       NameAr.forEach(itemText => {

			   contentString += `<button class="file-selected" onclick="partpicker( '${directoryChange}' , '${itemText}' , '${type}' );"  > ${itemText} </button></br>`;


       });
       contentString +=  '';                    
       loadFromGithub(type); 			

    } else {
      console.log('Directory is empty or path is invalid.');
    }
  });



 }



function hasExt(filename) {
  const regex = /\.([^.]+)$/; 
  return regex.test(filename);
}

 /* For now copy url to part import entry */
 /* Need to have check for file ext. If none use it as a directory and refresh with new subdirectory values */		      
 function partpicker( dirdata ,  itemdata = "none" , type = "part" ) {
              //console.log("part clicked "+itemdata);
            
              /* Need switch statement to find if itemdata has ext , if not its a directory change and refresh.  */
              switch( hasExt(itemdata) ) {

              case true: 				  
	       var toGetGit = "https://raw.githubusercontent.com/icarusfactor/designTmplPart/refs/heads/main/"+ dirdata + "/" + itemdata;
                if( type == "part" ) {					  
	          var inputElement = document.getElementById("rcdpURL"); 
	          inputElement.value = toGetGit;	     
			             }
                 if( type == "template") { 					  
	          var inputElement = document.getElementById("rcdtURL"); 
	          inputElement.value = toGetGit;	     
			             }
               break;
              case false:
               // add itemdata to path and refresh list.
	       const owner = 'icarusfactor'; 
               const repo = 'designTmplPart'; 
               GitDirChange( owner, repo, dirdata , itemdata , type );  						  
	       break;					  
	      default:
	       break;				  
	     }
	     }

 function loadFromGithub( type ) {
            //Now load up gitfile. 

		let listElement = "";     

	     switch( type  ) {
		case "part": 		 
                 listElement = document.getElementById("gitfilebox");                        
                 listElement.innerHTML = contentString;  
                 break;
		case "template":
                 listElement = document.getElementById("gitfileboxT");                        
                 listElement.innerHTML = contentString;  
	         break;
                default:
                 listElement = document.getElementById("gitfilebox");                        
                 listElement.innerHTML = contentString;  
                 break;					 
          	   }

	     }	    

    </script>

</head>
<body>

	    <div class="container"> 



	    <legend><b><h1>&nbsp;SETTINGS</h1></b>
	    </legend>
<fieldset>
<legend>&nbsp;Template Mailbox</legend>

        <button class="btn btn-primary" onclick="window.parent.createCheckTemplateMbox()" >CREATE / CHECK</button>
        <button class="btn btn-primary" onclick="window.parent.updateTmpl()" >SYNC</button>
	<button class="btn btn-primary" onclick="window.parent.InsertTemplatesMbox()" >INSTALL TEMPLATES</button> </BR></BR>

        &nbsp;This mailbox folder is used to pull base HTML email pages to work from and save them as drafts before final edit and sending them from Compose.
	You can move emails to this mailbox to create a new template and flag them to be recognized as such, no more than 10 templates can be 
	recognized,if you have more than ten, then these will be ignored until you unflag other templates. You can also make templates from inside the Design editor. If the servers templates gets out 
	of sync with client browser the editor can be updated from here to fix that.   


<BR>
<BR>
<button class="btn btn-primary" onclick="window.parent.ImportTmplURL()">Import URL .rcdt file:</button>&nbsp;<input maxlength="256" type="text" id="rcdtURL" name="rcdtURLInput" style="width: 300px;">  </BR> 

Template rcdt files are located here: https://github.com/icarusfactor/designTmplPart/tree/main/template<BR><BR>
	Below is a list of template fles with rcdt extention dynamically generated from Github, click one to load it into the above Import URL entry and then click that button to install it.<BR>
<button data-toggle="collapse" data-target="#gitfileT" onclick="GitDirChange( 'icarusfactor', 'designTmplPart', 'template' , '', 'template' );" >Copy GitHub Template Links To Entry</button>

<div id="gitfileT" class="collapse">
      <div class="scroll-box" id="gitfileboxT" contenteditable="false" >
         ... URL TEMPLATE LIST ... 
      </div>
</div>

</fieldset>


</fieldset>


<fieldset>
<legend>&nbsp;Part Mailbox</legend>

        <button class="btn btn-primary" onclick="window.parent.createCheckPartMbox()" >CREATE / CHECK</button>
	<button class="btn btn-primary" onclick="window.parent.updatePart()" >SYNC</button>&nbsp;<button class="btn btn-primary" onclick="window.parent.InsertPartMbox()" >INSTALL PARTS</button><BR><BR>
        &nbsp;This mailbox is used to pull HTML sections called Parts. You can move emails to this mailbox to create a new parts and flag them to be recognized. If servers parts gets out of sync with browser editor it can be updated from here.  

	<BR><BR>
<button class="btn btn-primary" onclick="window.parent.ImportPartURL()">Import URL .rcdp file:</button>&nbsp;<input maxlength="256" type="text" id="rcdpURL" name="rcdpURLInput" style="width: 300px;">  </BR> 
	Template rcdt files are located here:<BR>
	https://github.com/icarusfactor/designTmplPart/tree/main/part<BR><BR>

	Below is a list of part fles with rcdp extention dynamically generated from Github, click one to load it into the above Import URL entry and then click that button to install it.<BR>
<button data-toggle="collapse" data-target="#gitfileP" onclick="GitDirChange( 'icarusfactor', 'designTmplPart', 'part' , '', 'part' );" >Copy GitHub Part Links To Entry</button><BR>
<div id="gitfileP" class="collapse">
      <div class="scroll-box" id="gitfilebox" contenteditable="false" >
         ... URL PART LIST ... 
      </div>
</div>

</fieldset>



<fieldset>
<legend>&nbsp;Draft Mailbox</legend>

<button class="btn btn-primary" onclick="window.parent.CheckDraftMbox()" >CHECK</button></BR>
	This mailbox is used to save custom or modified templates to.You can from
	this directory select Edit to open it in the Composer to send out from. 
</fieldset>


<fieldset>
<legend>&nbsp;Plugin Client Values</legend>
    <button class="btn btn-primary" onclick="window.parent.clearIt('cookies')" >CLEAR COOKIES</button>
    <button class="btn btn-primary" onclick="window.parent.clearIt('localstorage' )" >CLEAR LOCAL STORAGE</button><BR>
   &nbsp;When lots of changes are made its good to start from scratch. Be sure to clear out your imap template and part mailboxs or it will autosync back in.
</fieldset>

    </div>  

    <!-- Optional JavaScript -->
    <!-- jQuery, Popper.js, and Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js" integrity="sha384-pjszLocalized/JnZ4ktSOCTVBlR3JJyXwYPlnLpZswuIpQWoxs9+azEvGzpeQEPVHIkKZaEjwg" crossorigin="anonymous"></script>

</body>
</html>
